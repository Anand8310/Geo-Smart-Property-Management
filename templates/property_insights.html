<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Property Insights</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { 
        font-family: 'Poppins', sans-serif; 
        background: linear-gradient(135deg, #eef2f3, #8e9eab); 
        padding: 2rem; 
        min-height: 100vh;
    }
    .container { 
        max-width: 900px; 
        margin: auto; 
        background: rgba(255, 255, 255, 0.85); 
        padding: 2rem; 
        border-radius: 1rem; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
    }
    h2 { font-weight: 600; color: #333; margin-bottom: 0.5rem; }
    h4 { color: #555; margin-bottom: 1rem; }
    a { text-decoration: none; color: #2575fc; font-weight: 500; }
    a:hover { text-decoration: underline; }
    .summary-cards { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem; justify-content: center; }
    .summary-card { flex: 1 1 180px; background: rgba(255,255,255,0.9); border-radius: 1rem; padding: 1.5rem; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .summary-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .summary-card i { font-size: 2rem; color: #2575fc; margin-bottom: 0.5rem; }
    .summary-card h3 { font-size: 1.5rem; margin: 0.25rem 0; color: #333; }
    .summary-card p { color: #555; font-size: 0.9rem; margin: 0; }
    .chart-container { margin-top: 2rem; background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .chart-container:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    canvas { max-width: 100%; height: 300px; }
</style>
</head>
<body>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>ðŸ“Š Analytics for Property #{{ view.kwargs.property_id }}</h2>
        <a href="{% url 'my_properties' %}"><i class="fas fa-arrow-left me-1"></i> Back to My Properties</a>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards" id="summaryCards">
        <div class="summary-card">
            <i class="fas fa-eye"></i>
            <h3 id="totalViews">0</h3>
            <p>Total Views</p>
        </div>
        <div class="summary-card">
            <i class="fas fa-thumbs-up"></i>
            <h3 id="totalLikes">0</h3>
            <p>Total Likes</p>
        </div>
        <div class="summary-card">
            <i class="fas fa-thumbs-down"></i>
            <h3 id="totalDislikes">0</h3>
            <p>Total Dislikes</p>
        </div>
        <div class="summary-card">
            <i class="fas fa-percentage"></i>
            <h3 id="engagementRate">0%</h3>
            <p>Engagement Rate</p>
        </div>
    </div>

    <!-- Charts -->
    <div class="chart-container">
        <h4>Views Over Last 7 Days</h4>
        <canvas id="viewsChart"></canvas>
    </div>

    <div class="chart-container">
        <h4>Likes vs. Dislikes</h4>
        <canvas id="likesChart"></canvas>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const propertyId = {{ view.kwargs.property_id }};

    fetch(`/api/insights/${propertyId}/`)
        .then(response => response.json())
        .then(data => {
            // Update summary cards
            document.getElementById('totalViews').innerText = data.total_views;
            document.getElementById('totalLikes').innerText = data.total_likes;
            document.getElementById('totalDislikes').innerText = data.total_dislikes;
            const engagementRate = data.total_views > 0 ? ((data.total_likes - data.total_dislikes)/data.total_views*100).toFixed(1) : 0;
            document.getElementById('engagementRate').innerText = engagementRate + '%';

            // Views Chart
            const viewsCtx = document.getElementById('viewsChart').getContext('2d');
            new Chart(viewsCtx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Daily Views',
                        data: data.view_counts,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Likes/Dislikes Chart
            const likesCtx = document.getElementById('likesChart').getContext('2d');
            new Chart(likesCtx, {
                type: 'bar',
                data: {
                    labels: ['Likes', 'Dislikes'],
                    datasets: [{
                        label: 'Engagement',
                        data: [data.total_likes, data.total_dislikes],
                        backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 99, 132, 0.7)'],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        });
});
</script>
</body>
</html>
